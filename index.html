<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Registros de Salud">
<!--<link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-iconn.png"/> -->
<link rel="apple-touch-icon" sizes="180x180" href="images/mio.png"/>

		
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap.min.css">
  </head>
  
<script data-require="jquery@*" data-semver="2.1.1" src="js/jquery-3.4.1.min.js"></script>
<script data-require="jqFhir@0.0.5" data-semver="0.0.5" src="js/jqFhir.js"></script>

 <script src="Chart.bundle.js"></script>

  

  
<body>
  
 
<div class="container-fluid">  
<nav class="navbar  navbar-expand-lg navbar-dark bg-primary">
   <a class="navbar-brand" href="#"><img src="images/Portal.png">&nbsp;&nbsp;&nbsp;<b id="system_name" class="font-weight-bold">Registros de Salud</b></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Fhir Client V.0</a>
      </li>
       
    </ul>
    
  </div>
</nav>
 <hr/>

	
	<div id="accordion">
  <div class="card border-primary mb-3" >
    <div class="card-header" id="headingOne">
      <h5 class="mb-3">
		<img onclick="busca()" src="images/person-4x.png">
        <button  class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne"><p id="patient_name" class="font-weight-bold">...</p>
        </button>
		
      </h5>
    </div>

    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
      <div class="card-body">
				<table>
  <tbody>
    <tr>
      <td class="align-middle" style="text-align:center">Gender: </td>
      <td id="gender" class="align-middle">...</td>
    </tr>
	<tr>
     <tr>
      <td class="align-middle" style="text-align:center">BoD: </td>
      <td id="bod" class="align-middle">...</td>
    </tr>
	<tr>
      <td class="align-middle" style="text-align:center">Phone: </td>
      <td id ="phone" class="align-middle">...</td>
    </tr>
	<tr>
      <td class="align-middle" style="text-align:center">Address: </td>
      <td id="addr" class="align-middle">...</td>
    </tr>
	<tr>
      <td class="align-middle" style="text-align:center">PoBx: </td>
      <td id="pobx" class="align-middle">...</td>
    </tr>
	<tr>
      <td class="align-middle" style="text-align:center">ID: </td>
      <td id="idi" class="align-middle">...</td>
    </tr>
  </tbody>
</table>
	  
	  
	  
       </div>
    </div>
  </div>
	
<!--	
<ul class="list-group mb-3">
  <li class="list-group-item   d-flex justify-content-between align-items-center">
    Care Plan
    <span id="careplani" class="badge badge-primary badge-pill">0</span>
  </li>
  <li class="list-group-item d-flex justify-content-between align-items-center">
    Encounter
    <span id="encounteri" class="badge badge-primary badge-pill">0</span>
  </li>
  <li class="list-group-item d-flex justify-content-between align-items-center">
    Medication
    <span id="medicationi" class="badge badge-primary badge-pill">0</span>
  </li>
  <li class="list-group-item d-flex justify-content-between align-items-center">
    Observation
    <span id="observationi" class="badge badge-primary badge-pill">0</span>
  </li>
</ul> -->
	


<div class="row">
  <div class="col">
    <div class="list-group border border-primary" id="list-tab" role="tablist">
	  <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" id="list-settings-list" data-toggle="list"  href="#list-home" role="tab" aria-controls="settings">Observaciones  <span id="observationi" class="badge badge-dark badge-pill">0</span></a>
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" id="list-home-list" data-toggle="list" href="#list-settings"  role="tab" aria-controls="home">Cuidados<span id="careplani" class="badge badge-dark badge-pill">0</span></a>
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">Episodios<span id="encounteri" class="badge badge-dark badge-pill">0</span></a>
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" id="list-messages-list" data-toggle="list" href="#list-messages" role="tab" aria-controls="messages">Medicación <span id="medicationi" class="badge badge-dark badge-pill">0</span></a>
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" id="list-chart-list" data-toggle="list" href="#list-chart" role="tab">ePizarra<span id="charti" class="badge badge-dark badge-pill">10</span></a>
    </div>
  </div>
</div>  
  <div class="col">
    <div class="tab-content border-primary" id="nav-tabContent">
      <div class="tab-pane fade" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
	  
<link href="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.css" rel="stylesheet">
<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.js"></script>
   
   
   
  

<hr/>
<h6 class="mb-3"><p><a href="CDA/cda.zip" target="_blank"><img src="images/document-4x.png"></a>&nbsp;&nbsp;&nbsp;Observaciones </p></h6>
<!--<button type="button" class="btn btn-outline-light" data-toggle="modal" data-target="#myModal"><img src="images/document-4x.png"></button> -->

<div class="table-responsive-sm border border-primary" style="height: 250px; overflow-y: scroll;">
<table  class="table table-responsive-sm datatable table-sm table-striped table-hover  mx-auto w-auto" id="table" 
options="thead-light" data-id-field="resource.code.coding.0.display" data-silent-sort="false"> 
 
<!--data-height="150"  "-->

  <thead>
    <tr>
      <th data-field="resource.code.coding.0.display" data-sortable="true">Nombre</th>
      <th data-field="resource.valueQuantity.value" data-sortable="true">Valor</th>
	  <th data-field="resource.effectiveDateTime" data-sortable="true">Fecha</th>
	  <!-- <th data-field="resource.effectiveDateTime" data-sortable="true" data-value-type="inline-line">inline-line</th>-->
     </tr>
  </thead>
</table>
</div>

<script>
  var $table = $('#table')

 // $(function() {
 //   var data = [
    
  //  ]
  //  $table.bootstrapTable({data: data})
 // })
</script>

	  
	  </div>
      <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list"><hr/>
<h6 class="mb-3"><p id="patient_name"><img onclick="busca()" src="images/document-4x.png">&nbsp;&nbsp;&nbsp;Episodios</p></h6></div>
      <div class="tab-pane fade" id="list-messages" role="tabpanel" aria-labelledby="list-messages-list"><hr/>
<h6 class="mb-3"><p id="patient_name"><img onclick="busca()" src="images/document-4x.png">&nbsp;&nbsp;&nbsp;Medicación</p></h6></div>
      <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list"><hr/>
<h6 class="mb-3"><p id="patient_name"><img onclick="busca()" src="images/document-4x.png">&nbsp;&nbsp;&nbsp;Cuidados</p></h6></div>
	  <div class="tab-pane fade" id="list-chart" role="tabpanel" aria-labelledby="list-chart-list"><hr/>
<h6 class="mb-3"><p id="patient_name"><img onclick="busca()" src="images/graph-4x.png">&nbsp;&nbsp;&nbsp;ePizarra
		
	
</p>
<img id="OrdenarA" src="images/sort-ascending-2x.png">&nbsp;
	<img id="OrdenarD" src="images/sort-descending-2x.png">&nbsp;
	<img id="removeDataset" src="images/delete-2x.png">&nbsp;&nbsp;&nbsp;
	<!--<img id="addDataset" src="images/pencil-2x.png">&nbsp;&nbsp;&nbsp; -->
	<img id="addDataset" src="images/pildora-2x.png">&nbsp;<select id="medicamento" onchange="addmedicamento()" style="font-size:8pt">
    <option>Amlodipine 5 MG</option>
    <option>Amlodipine 15 MG</option>
    </select>
<img id="addDataset" src="images/jerin-2x.png">&nbsp;<select id="determinacion" onchange="adddeterminacion()" style="font-size:8pt">
   <option>...</option>
  
  </select>

</h6>
<!-- <div class="bs-example">
	
    <div class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown"> <img id="addDataset" src="images/pildora-2x.png">&nbsp;Medicamento</a>
        <div class="dropdown-menu">
            <a onclick="addmedicamento()" class="dropdown-item">Amlodipine 5 MG Oral Tablet</a>
            <a onclick="addmedicamento()"class="dropdown-item">Amlodipine 5 MG Oral Tablet</a>
        </div>
    </div>

<div class="bs-example">
    <div class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown"><img id="addDataset" src="images/jerin-2x.png">&nbsp;Determinación</a>
        <div class="dropdown-menu">
           <a onclick="addmedicamento()" class="dropdown-item">Albúmina</a>
           <a onclick="addmedicamento()" class="dropdown-item">GPT</a>
		   <a onclick="addmedicamento()" class="dropdown-item">GOT</a>
           <a onclick="addmedicamento()" class="dropdown-item">Bilirrubina total</a>
		   <a onclick="addmedicamento()" class="dropdown-item">Creatinina plasmática</a>
           <a onclick="addmedicamento()" class="dropdown-item">I.N.R.</a>
        </div>
    </div>
</div> -->



			<div class="border border-primary">

			
			
				<div class="row">
					<div class="col-sm">
				<div class="col-15"><canvas id="myChart"></canvas></div>
				
	
				
				</div>

			
		</div>	
			
	</div>		
		

			
			</div>



</div>



    </div>

  </div>


	
	
	  
	  
	  
	

	

<hr/>

<div id="accordion2">
  <div class="card border-primary sm-3" >
    <div class="card-header" id="headingOne">
      <h5 class="mb-3">
		<img onclick="functionactualiza()" src="images/cog-4x.png">
        <button  class="btn btn-link" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseOne"><p id="configuration" class="font-weight-bold">Fhir Server Connection</p>
        </button>
		
      </h5>
    </div>

    <div id="collapseTwo" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion2">
      <div class="card-body">
	
	  
	<form>
  <div class="row">
    <div class="col">
     <select class="custom-select my-1 mr-sm-2 form-control-sm" id="inlineFormCustomSelectPref">
    <option selected>Choose...</option>
    <option value="http://hapi.fhir.org/baseR4/">Hospital Paco</option>
    <option value="https://stu3.test.pyrohealth.net/fhir/">Hospital Pepe</option>
    <option value="https://r3.smarthealthit.org/">Hospital Privado</option>
	<option value="http://localhost:9002/r3/">Lab (+)</option>
    </div>
    <div class="col">
       <input type="text" class="form-control mb-2 mr-sm-2 form-control-sm" id="inlineFormInputName2" placeholder="3b0420d8-8d7d-4add-b20b-2c9bbb9e6962" value="3b0420d8-8d7d-4add-b20b-2c9bbb9e6962">
    </div>
  </div>
</form>
  
	  
       </div>
    </div>
  </div>







</div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="jquery-3.2.1.slim.min.js"></script>
	<!--<script src="js/jquery.dataTables.min.js"></script> -->
	<!-- <script src="js/dataTables.rowGroup.min.js"></script> -->
    <script src="popper.min.js"></script>
    <script src="bootstrap.min.js"></script>
 



  </body>
  
  <script>
  var bundle;
  var grupo;
		var ctx = document.getElementById('myChart').getContext('2d');
     var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'line',
    //backgroundColor: "#F5DEB3"
    // The data for our dataset
    data: {
       labels:  [1, 2, 3],
        datasets: [{
            label: 'Creatinina',
			fill: false,
            borderColor: 'rgb(006,057,113)',
			backgroundColor:'rgb(006,057,118)',
			hoverBackgroundColor:'rgb(006,057,118)',
			lineTension: 0,
            data: [5,5,-5]
			 
	
        },
		{
            label: 'Min',
            //backgroundColor: 'rgb(255, 255, 000)',
			fill: false,
            borderColor: 'rgb(255, 255, 000)',
            data: [-2,-2,-2]
			
	
        },
		{
            label: 'Max',
            //backgroundColor: 'rgb(255, 255, 000)',
			fill: false,
            borderColor: 'rgb(255, 255, 000)',
            data: [5,5,5]
			
	
        }
		
		]
    },

    // Configuration options go here
    options: {
					
					responsive: true,
					maintainAspectRatio: true,
					
					tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},

					legend: {
						position: 'top',
						labels: {
							usePointStyle: true
						}

					},
					scales: {
					xAxes: [{
						display: true,
					
						scaleLabel: {
							display: false,
							fontSize: 12
							//labelString: 'Month'
						},
						gridLines: {
							display:true
						},
						ticks: {
                            maxTicksLimit: 10
                        }


					}],

					yAxes: [{
						display: 'auto',
					
						scaleLabel: {
							display: true,
							fontSize: 12
							//labelString: 'Value'
						},

						ticks: {
							suggestedMin: 20,
							suggestedMax: -20,
							stepSize: 2,
						    maxTicksLimit: 5
                        
						}
					}]}

}
});


//window.onload = function(){graf1.style.display ='none'; }

// recupero datos en array de array.

var array2=[[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5],[20190714,1.7,-1,5],[20190722,2,-1,5],[20190716,3,-1,2],[20190716,4,-2,2],[20170716,5,-2,2],[20190722,2,-1,5],[20190722,2,-1,5],[20150722,2,-1,5],[20190722,2,-1,5]];


var sortedArray = array2.sort(function(b,a) {
  if (a[0] == b[0]) {
    return a[1] - b[1];
  }
  return b[0] - a[0];
});


 		
datos =[];
min =[];
max =[];
etiqueta=[];
for(i=0;i<sortedArray.length;i++){
datos.push(sortedArray[i][1]);
etiqueta.push(sortedArray[i][0]);
min.push(sortedArray[i][2]);
max.push(sortedArray[i][3]);
}

chart.data.labels=etiqueta;
chart.data.datasets[0].data = datos;
//chart.data.datasets[0].label = "NUEVOOOOOO";
chart.data.datasets[1].data = min;
chart.data.datasets[2].data = max;

chart.update();
chart.update();
chart.update();
		
			
document.getElementById('OrdenarA').addEventListener('click', function() {

     var   sortedArray = array2.sort(function(b,a) {
		if (a[0] == b[0]) {
			return a[1] - b[1];
			}
			return b[0] - a[0];
		});
		datos =[];
		min =[];
		max =[];
		etiqueta=[];
		for(i=0;i<sortedArray.length;i++){
		datos.push(sortedArray[i][1]);
		etiqueta.push(sortedArray[i][0]);
		min.push(sortedArray[i][2]);
		max.push(sortedArray[i][3]);
		};
		chart.data.labels=etiqueta;
		chart.data.datasets[0].data = datos;
		chart.data.datasets[1].data = min;
		chart.data.datasets[2].data = max;
		chart.update();
});
document.getElementById('OrdenarD').addEventListener('click', function() {

    var  sortedArray = array2.sort(function(a,b) {
		if (a[0] == b[0]) {
			return a[1] - b[1];
			}
			return b[0] - a[0];
		});
		datos =[];
		min =[];
		max =[];
		etiqueta=[];
		for(i=0;i<sortedArray.length;i++){
		datos.push(sortedArray[i][1]);
		etiqueta.push(sortedArray[i][0]);
		min.push(sortedArray[i][2]);
		max.push(sortedArray[i][3]);
		};
		chart.data.labels=etiqueta;
		chart.data.datasets[0].data = datos;
		chart.data.datasets[1].data = min;
		chart.data.datasets[2].data = max;
		chart.update();
});			
			
	document.getElementById('removeDataset').addEventListener('click', function() {
			chart.data.datasets.pop();
			chart.update();
		});		
			
			
document.getElementById('addDataset').addEventListener('click', function() {

		var newDataset = {
				label: 'Dataset',
     			backgroundColor: 'rgb(255, 99, 132)',
	//		borderColor: dsColor,
	//			borderWidth: 1,
		        fill: true,
				data: [12,25,25,4,5,5,5,5,5,5,5,5,5,5,5]
			};

	//		for (var index = 0; index < barChartData.labels.length; ++index) {
	//			newDataset.data.push(randomScalingFactor());
	//		}
//
			chart.data.datasets.push(newDataset);
			//chart.data.labels=[12,25,25,4,5,5,5,5,5,5,5,5,5,225,5,5]
		 
			
			chart.update();
		});			
	

 function addmedicamento() {


        var x = document.getElementById("medicamento").value;
     

		var newDataset = {
				label: x,
     			backgroundColor: 'rgb(255, 99, 132)',
	//		borderColor: dsColor,
	//			borderWidth: 1,
		        fill: true,
				data: [12,25,25,4,5,5,5,5,5,5,5,5,5,5,5]
			};

	//		for (var index = 0; index < barChartData.labels.length; ++index) {
	//			newDataset.data.push(randomScalingFactor());
	//		}
//
			chart.data.datasets.push(newDataset);
			//chart.data.labels=[12,25,25,4,5,5,5,5,5,5,5,5,5,225,5,5]
		 
			
			chart.update();
		};
			



	






////////////////////////////////////////////////

function busca(){
  var datobs= [];
//	 $table.bootstrapTable({data: datobs});

//If you want to clear the data but keep the headers:

 //$table.bootstrapTable({data: datobs});

	var clientre = jqFhir({ baseUrl: document.getElementById('inlineFormCustomSelectPref').value }),
      patientId = document.getElementById('inlineFormInputName2').value;
	  var careplani=0;
	  var medicationi=0;
	  var observationi=0;
	  var indiceobs=0;
	  var grupo= [];
	  clientre.read({
      id: 'Patient/' + patientId +"/$everything?_count=500"
    }).then(function(pre) {
	
		bundle= pre.content.entry;
	 pre.content.entry.forEach(function(re) {
           
			 var ry=re.resource.code;
			 var ro=re.resource.valueQuantity;
		
              
			  if (re.resource.resourceType == "CarePlan"){
			   careplani=careplani+1;
			    
			  }
		
			   if (re.resource.resourceType == "Medication"){
			   medicationi=medicationi+1;
			    
			  }
			  
			   if (re.resource.resourceType == "Observation" && re.resource.category[0].coding[0].code=="laboratory"){
			   observationi=observationi+1;
			   datobs.push(re);
				nombre=re.resource.code.coding[0].display;
			  // console.log(indiceobs);
					if (datobs[indiceobs].resource.valueQuantity){
					valor=JSON.stringify(datobs[indiceobs].resource.valueQuantity.value);
					datobs[indiceobs].resource.valueQuantity.value= valor.substring(0,6)+" "+datobs[indiceobs].resource.valueQuantity.unit
					}
					
					if (datobs[indiceobs].resource.component){
					
					
					
					texto=JSON.stringify(datobs[indiceobs].resource.component[0].code.text).substring(0,10);
				   	texto=texto+" "+JSON.stringify(datobs[indiceobs].resource.component[0].valueQuantity.value)+JSON.stringify(datobs[indiceobs].resource.component[0].valueQuantity.unit);
					texto=texto+" "+JSON.stringify(datobs[indiceobs].resource.component[1].code.text).substring(0,10);
					texto=texto+" "+JSON.stringify(datobs[indiceobs].resource.component[1].valueQuantity.value)+JSON.stringify(datobs[indiceobs].resource.component[1].valueQuantity.unit);
					datobs[indiceobs].resource.valueQuantity= [{ "value": ""}];
					datobs[indiceobs].resource.valueQuantity.value=texto;
					
					
					}
				
				fecha=JSON.stringify(datobs[indiceobs].resource.effectiveDateTime);
				//datobs[indiceobs].resource.effectiveDateTime="("+fecha.substring(1,11)+":"+"22)";
				datobs[indiceobs].resource.effectiveDateTime=fecha.substring(1,11);
				//datobs[indiceobs].resource.effectiveDateTime="(1:10),(2:20),(3:30),(4:24),(5:40),(6:65),(7:70),(8:90)",
				  
				  // Group by name determinaciones...
				
				
							if(grupo.indexOf(re.resource.code.coding[0].display)=== -1){
								var select = document.getElementById("determinacion");
								select.options[select.options.length] = new Option(re.resource.code.coding[0].display,re.resource.code.coding[0].display);
				  
							}
							grupo.push(re.resource.code.coding[0].display);
				indiceobs=indiceobs+1;	
				
				
			  }
			   
            });
	
	 $("#careplani").text(careplani);
	 $("#medicationi").text(medicationi);
	 $("#observationi").text(observationi);
	 $table.bootstrapTable({data: datobs});
	
	});
}  

function functionactualiza(){
 
 // Set up a client and patient ID to talk to an un-authenticated FHIR server
 
// var client = jqFhir({ baseUrl: 'https://r3.smarthealthit.org/' }),
//        patientId = '3b0420d8-8d7d-4add-b20b-2c9bbb9e6962';

 var client = jqFhir({ baseUrl: document.getElementById('inlineFormCustomSelectPref').value }),
      patientId = document.getElementById('inlineFormInputName2').value;
	  




    client.read({
      id: 'Patient/' + patientId
    }).then(function(p) {
	
		if (p.content.name){
			var name = p.content.name[0];
		} else name="...";
	  
      var formatted = name.given +" "+ name.family;
	  formatted="José Luis Andreu";
	  var bod = p.content.birthDate;
	  var gender = p.content.gender;
	   if (p.content.telecom){
			var phone = p.content.telecom[0].value;
		}else {phone="..."};

	   if (p.content.address){
			var addr = p.content.address[0].line;
			var pobx = p.content.address[0].state+" "+p.content.address[0].postalCode;
			
		} else {addr="..."; pobx="..."}; 
	//  var addr = p.content.address[0].line;
	//  var pobx = p.content.address[0].state+" "+p.content.address[0].postalCode;
	
	 if (p.content.identifier){
			var idi = p.content.identifier[0].value;
		} else idi="..."; 
	//  var idi = p.content.identifier[0].value;

	  var cipa;
	  
	  sel=document.getElementById('inlineFormCustomSelectPref');
	  formatted=formatted
	  $("#system_name").text(sel.options[sel.selectedIndex].text);
      $("#patient_name").text(formatted);
	  $("#gender").text(gender);
	  $("#bod").text(bod);
	  $("#phone").text(phone);
	  $("#addr").text(addr);
	  $("#pobx").text(pobx);
	  $("#idi").text(idi);
	  
	
    });
}	

function adddeterminacion() {


        var x = document.getElementById("determinacion").value;
     
		//x contiene ->
	   var y=JSON.stringify(bundle[0].resource.resourceType);
	   
	   var yy=0;
	   var data=[];
		var labels=[];
	bundle.forEach(function(re) {
			
					if(re.resource.resourceType == "Observation" && re.resource.category[0].coding[0].code=="laboratory"){
						if (re.resource.code.coding[0].display==x){
	//			
						yy=yy+1;
					
						data.push(parseInt(JSON.stringify(re.resource.valueQuantity.value)));
						labels.push("");
						}
					}	
		
	   
				
	});
		
		var newDataset = {
				label: x +" "+data,
     			backgroundColor: 'rgb(255, 99, 132)',
	//		borderColor: dsColor,
	//			borderWidth: 1,
		        fill: true,
				data: data
			};

	//		for (var index = 0; index < barChartData.labels.length; ++index) {
	//			newDataset.data.push(randomScalingFactor());
	//		}
//
			chart.data.datasets.push(newDataset);
			chart.data.labels=labels;
			
			chart.update();
			
			

		};

</script>

</html>